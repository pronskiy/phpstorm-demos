Extract method improvements, p.1

Some stats:
22% â€“ can't extract selected code
16% - cancel dialog

Goals:
0. Gain user's trust -- fix bugs (not shown, many fixes)
1. Increase success rate
2. Improve usability
3. Promote refactoring

TODO:
1) support `)` like ;